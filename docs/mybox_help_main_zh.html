<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>MyBox帮助</title>
        <style type="text/css">
            body {font-size:14px;
                  /*
                  font-family:
                           -apple-system, BlinkMacSystemFont,
                           "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans",
                           "Helvetica Neue", sans-serif;
                  */
            }
            p.p1 {text-indent: 0em; font-size:17px;font-weight:bold; color:darkgreen}
            p.p2 {text-indent: 0em; font-size:15px;font-weight:bold}
            p.p3 {text-indent: 0em; font-size:14px;font-weight:bold}
            .article {width: 100%; margin:0 auto;font-size:14px;font-weight:normal;}
            .paragraph {text-indent: 2em; font-size:14px;}
            .link {text-indent: 6em; font-size:14px;}
            .command {text-indent: 6em; font-size:14px; color:darkblue}
            .pix {text-indent: 6em; }
            .refer {text-indent: 6em; font-size:14px; color:darkblue}
            ol.inside {list-style-position: inside; text-indent: 2em;}
            .description {font-size:14px; padding: 5px; background-color:#336633; font-weight:bord; color: white}
            .codes {font-size:14px; padding: 5px; background-color:black; font-weight:normal; color: #CCFF99}
            .table1 {font-size:14px; width:90%; border-collapse:collapse; border:solid 1px;}
            tr {border:solid#000 1px;}
            td {border:solid#000 1px; }
            .Header { font-weight:bold; text-align:center;}
            .Data {font-weight:normal; text-align:left; }
            ul.inside {list-style-position: inside; text-indent: 2em;}
        </style>
    </head>
    <body class="article" >

        <div id="about">
            <br><br>
            <h2 align="center">MyBox</h2>
            <br>
            <P class="p1">关于MyBox</P>
            <P class="paragraph">这是利用JavaFx开发的图形化界面程序，目标是提供简单易用的功能。免费开源。</P>
            <P class="paragraph">项目主页: </P>
            <p class="link"><a href="https://github.com/Mararsh/MyBox" target=_blank>https://github.com/Mararsh/MyBox</a></p>
            <P class="paragraph">MyBox使用NetBeans 8.2和JavaFX Scene Builder 2.0开发：</P>
            <p class="link"><a href="https://netbeans.org/" target=_blank>https://netbeans.org/</a></p>
            <p class="link"><a href="https://www.oracle.com/technetwork/java/javafxscenebuilder-1x-archive-2199384.html" target=_blank>
                    https://www.oracle.com/technetwork/java/javafxscenebuilder-1x-archive-2199384.html</a></p>
            <P class="paragraph">基于以下开源软件/开源库：</P>
            <p class="link">JavaFx  <a href="https://docs.oracle.com/javafx/2/" target=_blank>https://docs.oracle.com/javafx/2/</a></p>
            <p class="link">PDFBox  <a href="https://pdfbox.apache.org/" target=_blank>https://pdfbox.apache.org/</a></p>
            <p class="link">jai-imageio  <a href="https://github.com/jai-imageio/jai-imageio-core" target=_blank>https://github.com/jai-imageio/jai-imageio-core</a></p>
            <p class="link">javazoom  <a href="http://www.javazoom.net/index.shtml" target=_blank>http://www.javazoom.net/index.shtml</a></p>
            <p class="link">log4j  <a href="https://logging.apache.org/log4j/2.x/" target=_blank>https://logging.apache.org/log4j/2.x/</a></p>
            <p class="link">Derby  <a href="http://db.apache.org/derby/" target=_blank>http://db.apache.org/derby/</a></p>
            <p class="link">GifDecoder  <a href="https://github.com/DhyanB/Open-Imaging" target=_blank>https://github.com/DhyanB/Open-Imaging</a></p>
        </div>


        <br><br>
        <div id="MetaData">
            <P class="p1">图像的元数据</P>
            <p class="link"><a href="https://docs.oracle.com/javase/10/docs/api/javax/imageio/metadata/doc-files/standard_metadata.html" target=_blank>
                    https://docs.oracle.com/javase/10/docs/api/javax/imageio/metadata/doc-files/standard_metadata.html</a></p>
            <p class="link"><a href="https://docs.oracle.com/javase/10/docs/api/javax/imageio/metadata/doc-files/gif_metadata.html" target=_blank>
                    https://docs.oracle.com/javase/10/docs/api/javax/imageio/metadata/doc-files/gif_metadata.html</a></p>
            <p class="link"><a href="https://docs.oracle.com/javase/10/docs/api/javax/imageio/metadata/doc-files/jpeg_metadata.html" target=_blank>
                    https://docs.oracle.com/javase/10/docs/api/javax/imageio/metadata/doc-files/jpeg_metadata.html</a></p>
            <p class="link"><a href="https://docs.oracle.com/javase/10/docs/api/javax/imageio/metadata/doc-files/png_metadata.html" target=_blank>
                    https://docs.oracle.com/javase/10/docs/api/javax/imageio/metadata/doc-files/png_metadata.html</a></p>
            <p class="link"><a href="https://docs.oracle.com/javase/10/docs/api/javax/imageio/metadata/doc-files/tiff_metadata.html" target=_blank>
                    https://docs.oracle.com/javase/10/docs/api/javax/imageio/metadata/doc-files/tiff_metadata.html</a></p>
        </div>

        <br><br>
        <div id="JavaImageIO">
            <P class="p1">关于Java图像输入/输出技术</P>
            <p class="link"><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/imageio/" target=_blank>
                    https://docs.oracle.com/javase/8/docs/technotes/guides/imageio/</a></p>
            <p class="link"><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/imageio/spec/imageio_guideTOC.fm.html" target=_blank>
                    https://docs.oracle.com/javase/8/docs/technotes/guides/imageio/spec/imageio_guideTOC.fm.html</a></p>
            <p class="link"><a href="https://docs.oracle.com/javase/tutorial/2d/index.html" target=_blank>
                    https://docs.oracle.com/javase/tutorial/2d/index.html</a></p>
            <p class="link"><a href="https://www.javaworld.com/article/2076764/java-se/image-processing-with-java-2d.html" target=_blank>
                    https://www.javaworld.com/article/2076764/java-se/image-processing-with-java-2d.html</a></p>
        </div>


        <br><br>
        <div id="Compression">
            <P class="p1">图像的压缩类型</P>
            <div align="center" >
                <table border=1 width="600">
                    <caption><b>图像格式"bmp"支持的压缩类型</b><BR>
                        基于类接口"com.github.jaiimageio.plugins.bmp.BMPImageWriteParam"整理<BR>
                    </caption>
                    <tr><th>压缩类型</th> <th>描述</th>  <th>图像类型</th></tr>
                    <tr><td>BI_RGB</td>  <td>Uncompressed RLE</td> <td><= 8-bits/sample</td></tr>
                    <tr><td>BI_RLE8</td> <td>8-bit Run Length Encoding</td> <td><= 8-bits/sample</td></tr>
                    <tr><td>BI_RLE4</td> <td>4-bit Run Length Encoding</td> <td><= 4-bits/sample</td></tr>
                    <tr><td>BI_BITFIELDS</td> <td>Packed data</td> <td> 16 or 32 bits/sample</td></tr>
                    <tr><td>BI_JPEG</td> <td>JPEG encoded</td> <td>grayscale or RGB image</td></tr>
                </table>
            </div>
            <BR><BR>
            <div  align="center">
                <table border=1 width="90%">
                    <caption><b>图像格式"tif"/"tiff"支持的压缩类型</b><BR>
                        基于类接口"com.github.jaiimageio.plugins.tiff.TIFFImageWriteParam"整理<BR>
                    </caption>
                    <tr><th>压缩类型</th> <th>描述</th> <th>参考</th></tr>
                    <tr>
                        <td>CCITT RLE</td>
                        <td>Modified Huffman compression</td>
                        <td>TIFF 6.0 Specification, Section 10</td>
                    </tr>
                    <tr>
                        <td>CCITT T.4</td>
                        <td>CCITT T.4 bilevel encoding/Group 3 facsimile compression</td>
                        <td>TIFF 6.0 Specification, Section 11</td>
                    </tr>
                    <tr>
                        <td>CCITT T.6</td>
                        <td>CCITT T.6 bilevel encoding/Group 4 facsimile compression</td>
                        <td>TIFF 6.0 Specification, Section 11</td></tr>
                    <tr>
                        <td>LZW</td>
                        <td>LZW compression</td>
                        <td>TIFF 6.0 Specification, Section 13</td></tr>
                    <tr>
                        <td>JPEG</td>
                        <td>"New" JPEG-in-TIFF compression</td>
                        <td><a href="ftp://ftp.sgi.com/graphics/tiff/TTN2.draft.txt">TIFF
                                Technical Note #2</a></td>
                    </tr>
                    <tr>
                        <td>ZLib</td>
                        <td>"Deflate/Inflate" compression</td>
                        <td><a href="http://partners.adobe.com/asn/developer/pdfs/tn/TIFFphotoshop.pdf">
                                Adobe Photoshop&#174; TIFF Technical Notes</a> (PDF)</td>
                    </tr>
                    <tr>
                        <td>PackBits</td>
                        <td>Byte-oriented, run length compression</td>
                        <td>TIFF 6.0 Specification, Section 9</td>
                    </tr>
                    <tr>
                        <td>Deflate</td>
                        <td>"Zip-in-TIFF" compression</td>
                        <td><a href="http://www.isi.edu/in-notes/rfc1950.txt">
                                ZLIB Compressed Data Format Specification</a>,
                            <a href="http://www.isi.edu/in-notes/rfc1951.txt">
                                DEFLATE Compressed Data Format Specification</a></td>
                    </tr>
                    <tr>
                        <td>EXIF JPEG</td>
                        <td>EXIF-specific JPEG compression</td>
                        <td><a href="http://www.exif.org/Exif2-2.PDF">EXIF 2.2 Specification</a>
                            (PDF), section 4.5.5, "Basic Structure of Thumbnail Data"</td>
                </table>
            </div>
        </div>

        <br><br>
        <div id="MultipleFramesImageFile">
            <P class="p1">关于多帧图像文件</P>
            <P class="paragraph">即一个文件中保存有多个独立的图像。</P>
            <P class="paragraph">目前MyBox支持的多帧图像文件格式是：动画gif和tiff/tif。</P>
        </div>


        <br><br>
        <div id="Tiff">
            <P class="p1">关于Tiff文件格式</P>
            <P class="paragraph">关于Tiff/Tif:</P>
            <p class="link"><a href="https://en.wikipedia.org/wiki/TIFF" target=_blank>https://en.wikipedia.org/wiki/TIFF</a></p>
            <p class="link"><a href="https://en.wikipedia.org/wiki/GeoTIFF" target=_blank>https://en.wikipedia.org/wiki/GeoTIFF</a></p>
            <p class="link"><a href="https://www.adobe.io/open/standards/TIFF.html" target=_blank>https://www.adobe.io/open/standards/TIFF.html</a></p>
        </div>


        <br><br>
        <div id="AnimatedGif">
            <P class="p1">关于动画Gif</P>
            <p class="link"><a href="http://giflib.sourceforge.net/whatsinagif/index.html" target=_blank>http://giflib.sourceforge.net/whatsinagif/index.html</a></p>
            <p class="link"><a href="https://www.jianshu.com/p/df52f1511cf8" target=_blank>https://www.jianshu.com/p/df52f1511cf8</a></p>
            <p class="link"><a href="https://stackoverflow.com/questions/22259714/arrayindexoutofboundsexception-4096-while-reading-gif-file" target=_blank>
                    https://stackoverflow.com/questions/22259714/arrayindexoutofboundsexception-4096-while-reading-gif-file</a></p>
            <p class="link"><a href="https://github.com/DhyanB/Open-Imaging" target=_blank>https://github.com/DhyanB/Open-Imaging</a></p>
            <p class="link"><a href="https://programtalk.com/python-examples/com.sun.media.imageioimpl.plugins.gif.GIFImageWriterSpi/" target=_blank>
                    https://programtalk.com/python-examples/com.sun.media.imageioimpl.plugins.gif.GIFImageWriterSpi/</a></p>
        </div>

        <br><br>
        <div id="BigImage">
            <P class="p1">关于大图像</P>
            <P class="paragraph">所谓大图像指：图像像素非常多，以至于无法在现有内存约束下全部加载并显示出来的图像。
                对于所有以图像文件为输入的操作，都需要处理大图像的情形。 </P>
            <P class="paragraph">对内存造成压力的是图像的像素总数、而不是图像文件的字节数。 </P>
            <P class="paragraph">例如，一个42M的jpg文件，包含65500x4504个像素，每个像素占3字节，故图像数据占用内存844M字节。
                若要把整个图像显示在Javafx界面上，数据需要在文件、BufferedImage、和WritableImage之间倒腾，本以为需要内存约三倍多一点即2.6G，
                但是结果是4.5G都不行，最后大约需要申请5.2G内存才加载成功，而运行时显示只占2.3G。 </P>
            <P class="paragraph">又如，一个52M的png文件，像素8101x4557，图像数据是147M字节，只需要内存大约750M就可以了。</P>
            <P class="paragraph">MyBox处理大图像的原则是：</P>
            <OL>
                <LI>评估加载整个图像所需内存,判断能否加载整个图像。（按像素数据的5倍+200M）</LI>
                <LI>若可用内存足够载入整个图像，则读取图像所有数据做下一步处理。尽可能内存操作而避免文件读写。</LI>
                <LI>若内存可能溢出，则采样读取图像数据做下一步处理。</LI>
                <LI>采样比的选择：即要保证采样图像足够清晰、又要避免采样数据占用过多内存。</LI>
                <LI>采样图像主要用于显示图像。已被采样的大图像，不适用于图像整体的操作和图像合并操作。</LI>
                <LI>一些操作，如分割图像、降采样图像，可以局部读取图像数据、边读边写，因此适用于大图像。</LI>
                <LI>无法整体加载处理的图像，未必不能批量处理。
                    例如，一个500M像素数据的图像，无法在1.8G可用内存的限制下全部加载显示，因此无法实现交互式的剪裁、缩放和颜色处理；
                    但是做批量剪裁、缩放和颜色处理时，因为图像不显示到界面上，操作所需内存可能只需1.7G，从而执行成功。</LI>
            </OL>
            <P class="paragraph">连续处理较大的图像，会影响内存占用情形：前一次操作的内存可能还没有被回收，则下一次操作的可用内存就变少了。
                所以，最好重新打开工具来处理大图像，这样它可以就占用绝大多数可用内存。</P>

            <P class="paragraph">为了能交互式处理大图像， 用户可以扩展JVM的最大内存。</P>
        </div>


        <br><br>
        <div id="ImageSample">
            <P class="p1">关于图像采样</P>
            <P class="paragraph">图像采样分为：降采样（Downsampling，也叫子采样Subsampling）、和升采样（Upsampling，也叫插值interpolating）。</P>
            <P class="paragraph">当图像像素值非常大时，降采样有助于在可用内存的有限范围内加载和显示整个图像的样子。</P>
            <P class="paragraph">降采样的算法很简单：指定宽度和高度的采样比率，则图像的像素被选择提取出来。例如，比率为3，表示宽度3高度3的相邻矩阵只取一个像素点。</P>
            <P class="paragraph">图像降采样主要用来处理大图像。当采样率为1时，相当于剪裁功能。
                它与“图像处理”工具的剪裁功能和大小功能的差别在于：对于大图像，此工具是只读采样区域、边读边写，从而避免内存溢出。
                对于小图像，此工具与“图像处理”工具一样：都是读取图像所有数据、在内存里处理数据。</P>
        </div>

        <br><br>
        <div id="Memory">
            <P class="p1">如何扩展JVM的最大内存</P>
            <P class="paragraph">缺省的JVM最大内存是物理内存的1/4。当系统中内存充裕，可以扩充JVM最大内存，以加快处理速度和确保大图像可被处理。</P>
            <P class="paragraph">你可以用以下方法之一来扩展工具可用的内存：（假设有5G可用）</P>
            <P class="paragraph">  1）运行以下命令来启动工具：</P>
            <P class="command">
                java   -Xmx5g  -jar MyBox-xxx.jar
            </P>
            <P class="paragraph"> 2）设置以下环境变量（或者把这个值添加到原有JAVA_OPTS字串里）
            <P class="command">
                JAVA_OPTS=" -Xmx5000m "
            </P>
            <P class="paragraph"> 重启工具以使扩展的内存设置生效。
        </div>




        <br><br>
        <div id="Grayscale">
            <P class="p1">关于图像的灰度</P>
            <p class="link"><a href="https://en.wikipedia.org/wiki/HSL_and_HSV" target=_blank>https://en.wikipedia.org/wiki/HSL_and_HSV</a></p>
            <p class="link"><a href="https://en.wikipedia.org/wiki/Grayscale" target=_blank>https://en.wikipedia.org/wiki/Grayscale</a></p>
        </div>

        <br><br>
        <div id="ColorDistance">
            <P class="p1">关于颜色距离</P>
            <p class="link"><a href="https://en.wikipedia.org/wiki/Color_difference" target=_blank>https://en.wikipedia.org/wiki/Color_difference</a></p>
        </div>

        <br><br>
        <div id="Sepia">
            <P class="p1">如何把图像转变成褐色</P>
            <p class="link"><a href="https://stackoverflow.com/questions/21899824/java-convert-a-greyscale-and-sepia-version-of-an-image-with-bufferedimage/21900125#21900125" target=_blank>
                    https://stackoverflow.com/questions/21899824/java-convert-a-greyscale-and-sepia-version-of-an-image-with-bufferedimage/21900125#21900125</a></p>
        </div>

        <br><br>
        <div id="Blending">
            <P class="p1">关于图像的混合模式</P>
            <p class="link"><a href="https://en.wikipedia.org/wiki/Blend_modes" target=_blank>https://en.wikipedia.org/wiki/Blend_modes</a></p>
            <p class="link"><a href="https://baike.baidu.com/item/%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F/6700481?fr=aladdin" target=_blank>https://baike.baidu.com/item/混合模式/6700481?fr=aladdin</a></p>
            <p class="link"><a href="https://blog.csdn.net/bravebean/article/details/51392440" target=_blank>https://blog.csdn.net/bravebean/article/details/51392440</a></p>
            <p class="link"><a href="https://www.cnblogs.com/bigdream6/p/8385886.html" target=_blank>https://www.cnblogs.com/bigdream6/p/8385886.html</a></p>
        </div>


        <br><br>
        <div id="Convolution">
            <P class="p1">关于卷积</P>
            <p class="link"><a href="https://en.wikipedia.org/wiki/Convolution" target=_blank>
                    https://en.wikipedia.org/wiki/Convolution</a></p>
            <p class="link"><a href="https://en.wikipedia.org/wiki/Kernel_(image_processing)" target=_blank>
                    https://en.wikipedia.org/wiki/Kernel_(image_processing)</a></p>
            <p class="link"><a href="http://colah.github.io/posts/2014-07-Understanding-Convolutions/" target=_blank>
                    http://colah.github.io/posts/2014-07-Understanding-Convolutions/</a></p>
        </div>

        <br><br>
        <div id="FloodFill">
            <P class="p1">关于漫灌算法（魔术棒抠图）</P>
            <p class="link"><a href="https://en.wikipedia.org/wiki/Flood_fill" target=_blank>https://en.wikipedia.org/wiki/Flood_fill</a></p>
        </div>


        <br><br>
        <div id="Charset">
            <P class="p1">关于文字的字符集和编码</P>
            <P class="paragraph">字符集指：字符（显示/打印）与字节（计算机存储）的对应关系。而编码指：字节在载体（文件/内存）中存放方式。</P>
            <p class="link"><a href="https://en.wikipedia.org/wiki/UTF-8" target=_blank>https://en.wikipedia.org/wiki/UTF-8</a></p>
            <p class="link"><a href="https://www.cnblogs.com/ChurchYim/p/8427373.html" target=_blank>https://www.cnblogs.com/ChurchYim/p/8427373.html</a></p>
            <p class="link"><a href="https://www.cnblogs.com/maohuidong/p/8044568.html" target=_blank>https://www.cnblogs.com/maohuidong/p/8044568.html</a></p>
        </div>


        <br><br>
        <div id="PackExe">
            <P class="p1">如何打包成exe程序</P>
            <P class="paragraph">把编译后的jar文件复制到一个临时目录下，如“D:\tmp\src”，然后执行以下命令：（命令“javapackager”在JDK的bin目录下）</P>
            <P class="command">
                javapackager -deploy -native image -appclass mara.mybox.MainApp -srcdir D:\tmp\src -outdir D:\tmp\out -outfile MyBox -name MyBox
            </P>
            <P class="paragraph">可运行的exe文件就生成在目录“D:\tmp\out\bundles”下了。</P>
            <P class="paragraph">如果此命令提示缺少辅助工具，则按提示下载。</P>
        </div>

    </body>
</html>